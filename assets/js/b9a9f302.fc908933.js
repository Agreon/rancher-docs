"use strict";(self.webpackChunkrancher_docs=self.webpackChunkrancher_docs||[]).push([[71625],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),c=p(n),d=i,g=c["".concat(s,".").concat(d)]||c[d]||u[d]||r;return n?a.createElement(g,l(l({ref:t},m),{},{components:n})):a.createElement(g,l({ref:t},m))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},43727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>p,toc:()=>u});n(67294);var a=n(3905);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const o={title:"Pod Security Admission (PSA) Configuration Templates"},s=void 0,p={unversionedId:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates",id:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates",title:"Pod Security Admission (PSA) Configuration Templates",description:"Pod Security admission (PSA) configuration templates are a Rancher custom-defined resource (CRD), available in Rancher v2.7.2 and above. The templates provide pre-defined security configurations that you can apply to a cluster:",source:"@site/docs/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates.md",sourceDirName:"how-to-guides/new-user-guides/authentication-permissions-and-global-configuration",slug:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates",draft:!1,editUrl:"https://github.com/rancher/rancher-docs/edit/main/docs/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/psa-config-templates.md",tags:[],version:"current",lastUpdatedAt:1683713826,formattedLastUpdatedAt:"May 10, 2023",frontMatter:{title:"Pod Security Admission (PSA) Configuration Templates"},sidebar:"tutorialSidebar",previous:{title:"Pod Security Standards (PSS) & Pod Security Admission (PSA)",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/pod-security-standards"},next:{title:"Configuring a Global Default Private Registry",permalink:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/global-default-private-registry"}},m={},u=[{value:"Assign a Pod Security Admissions (PSA) Configuration Template",id:"assign-a-pod-security-admissions-psa-configuration-template",level:2},{value:"Assign a Template During Cluster Creation",id:"assign-a-template-during-cluster-creation",level:3},{value:"Assign a Template to an Existing Cluster",id:"assign-a-template-to-an-existing-cluster",level:3},{value:"Hardening the Cluster",id:"hardening-the-cluster",level:3},{value:"Assign a Template to an Existing Cluster",id:"assign-a-template-to-an-existing-cluster-1",level:3},{value:"Add or Edit a Pod Security Admissions (PSA) Configuration Template",id:"add-or-edit-a-pod-security-admissions-psa-configuration-template",level:2},{value:"Allow Non-Admin Users to Manage PSA Templates",id:"allow-non-admin-users-to-manage-psa-templates",level:3},{value:"Exempting Required Rancher Namespaces",id:"exempting-required-rancher-namespaces",level:2},{value:"Exempting Namespaces",id:"exempting-namespaces",level:2}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,a.kt)("div",t)},d=c("Tabs"),g=c("TabItem"),k={toc:u};function h(e){var{components:t}=e,n=l(e,["components"]);return(0,a.kt)("wrapper",r(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},a=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),a.forEach((function(t){i(e,t,n[t])}))}return e}({},k,n),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/pod-security-standards"},"Pod Security admission (PSA)")," configuration templates are a Rancher custom-defined resource (CRD), available in Rancher v2.7.2 and above. The templates provide pre-defined security configurations that you can apply to a cluster:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"rancher-privileged"),": The most permissive configuration. It doesn't restrict the behavior of any pods. This allows for known privilege escalations. This policy has no exemptions."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"rancher-restricted"),": A heavily restricted configuration that follows current best practices for hardening pods. You must make ",(0,a.kt)("a",{parentName:"li",href:"/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/pod-security-standards#rancher-on-psa-restricted-clusters"},"namespace-level exemptions")," for Rancher components.")),(0,a.kt)("h2",{id:"assign-a-pod-security-admissions-psa-configuration-template"},"Assign a Pod Security Admissions (PSA) Configuration Template"),(0,a.kt)("p",null,"You can assign a PSA template at the same time that you create a downstream cluster. You can also add a template by configuring an existing cluster."),(0,a.kt)("h3",{id:"assign-a-template-during-cluster-creation"},"Assign a Template During Cluster Creation"),(0,a.kt)(d,{mdxType:"Tabs"},(0,a.kt)(g,{value:"RKE2 and K3s",mdxType:"TabItem"},(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Clusters")," page, click the ",(0,a.kt)("strong",{parentName:"li"},"Create")," button."),(0,a.kt)("li",{parentName:"ol"},"Select a provider."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Cluster: Create")," page, go to ",(0,a.kt)("strong",{parentName:"li"},"Basics > Security"),"."),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admission Configuration Template")," dropdown menu, select the template you want to assign."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Create"),".")),(0,a.kt)("h3",{id:"assign-a-template-to-an-existing-cluster"},"Assign a Template to an Existing Cluster"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"Find the cluster you want to update in the ",(0,a.kt)("strong",{parentName:"li"},"Clusters")," table, and click the ",(0,a.kt)("strong",{parentName:"li"},"\u22ee"),"."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Edit Config")," ."),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admission Configuration Template")," dropdown menu, select the template you want to assign."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Save"),".")),(0,a.kt)("h3",{id:"hardening-the-cluster"},"Hardening the Cluster"),(0,a.kt)("p",null,"If you select the ",(0,a.kt)("strong",{parentName:"p"},"rancher-restricted")," template but don't select a ",(0,a.kt)("strong",{parentName:"p"},"CIS Profile"),", you won't meet required CIS benchmarks. See the ",(0,a.kt)("a",{parentName:"p",href:"/pages-for-subheaders/rke2-hardening-guide"},"RKE2 hardening guide")," for more details.")),(0,a.kt)(g,{value:"RKE1",mdxType:"TabItem"},(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Clusters")," page, click the ",(0,a.kt)("strong",{parentName:"li"},"Create")," button."),(0,a.kt)("li",{parentName:"ol"},"Select a provider."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Add Cluster")," page, under ",(0,a.kt)("strong",{parentName:"li"},"Cluster Options"),", click ",(0,a.kt)("strong",{parentName:"li"},"Advanced Options"),"."),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admission Configuration Template")," dropdown menu, select the template you want to assign."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Create"),".")),(0,a.kt)("h3",{id:"assign-a-template-to-an-existing-cluster-1"},"Assign a Template to an Existing Cluster"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"Find the cluster you want to update in the ",(0,a.kt)("strong",{parentName:"li"},"Clusters")," table, and click the ",(0,a.kt)("strong",{parentName:"li"},"\u22ee"),"."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Edit Config"),"."),(0,a.kt)("li",{parentName:"ol"},"On the ",(0,a.kt)("strong",{parentName:"li"},"Edit Cluster")," page, go to ",(0,a.kt)("strong",{parentName:"li"},"Cluster Options > Advanced Options"),"."),(0,a.kt)("li",{parentName:"ol"},"In the ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admission Configuration Template"),", select the template you want to assign."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Save"),".")))),(0,a.kt)("h2",{id:"add-or-edit-a-pod-security-admissions-psa-configuration-template"},"Add or Edit a Pod Security Admissions (PSA) Configuration Template"),(0,a.kt)("p",null,"If you have administrator privileges, you can customize security restrictions and permissions by creating additional PSA templates, or by editing existing templates."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"If you edit an existing PSA template while it is still in use, changes will be applied to all clusters that have been assigned to that template.")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Advanced")," to open the dropdown menu."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admissions"),"."),(0,a.kt)("li",{parentName:"ol"},"Find the template you want to modify, and click the ",(0,a.kt)("strong",{parentName:"li"},"\u22ee"),"."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Edit Config")," to edit the template."),(0,a.kt)("li",{parentName:"ol"},"When you're done editing the configuration, click ",(0,a.kt)("strong",{parentName:"li"},"Save"),".")),(0,a.kt)("h3",{id:"allow-non-admin-users-to-manage-psa-templates"},"Allow Non-Admin Users to Manage PSA Templates"),(0,a.kt)("p",null,"If you want to allow other users to manage templates, you can bind that user to a role that grants all verbs (",(0,a.kt)("inlineCode",{parentName:"p"},'"*"'),") on ",(0,a.kt)("inlineCode",{parentName:"p"},"management.cattle.io/podsecurityadmissionconfigurationtemplates"),"."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Any user that is bound to the above permission will be able to change the restriction levels on ",(0,a.kt)("em",{parentName:"p"},"all")," managed clusters which use a given PSA template, including ones that they have no permissions on.")),(0,a.kt)("h2",{id:"exempting-required-rancher-namespaces"},"Exempting Required Rancher Namespaces"),(0,a.kt)("p",null,"When you run Rancher on a Kubernetes cluster that enforces a restrictive security policy by default, you'll need to ",(0,a.kt)("a",{parentName:"p",href:"#exempting-namespaces"},"exempt the following namespaces"),", otherwise the policy might prevent Rancher system pods from  running properly."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"calico-apiserver")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"calico-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-alerting")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-csp-adapter-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-epinio-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-externalip-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-fleet-local-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-fleet-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-gatekeeper-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-global-data")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-global-nt")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-impersonation-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-istio")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-istio-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-logging")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-logging-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-monitoring-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-neuvector-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-prometheus")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-sriov-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-ui-plugin-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cattle-windows-gmsa-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cert-manager")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cis-operator-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fleet-default")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ingress-nginx")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"istio-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-node-lease")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-public")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kube-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"longhorn-system")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"rancher-alerting-drivers")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"security-scan")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tigera-operator"))),(0,a.kt)("p",null,"Rancher, some Rancher owned charts, and RKE2 and K3s distributions all use these namespaces. A subset of the listed namespaces are already exempt in the built-in Rancher ",(0,a.kt)("inlineCode",{parentName:"p"},"rancher-restricted")," policy, for use in downstream clusters. For a complete template which has all the exemptions you need to run Rancher, please refer to this ",(0,a.kt)("a",{parentName:"p",href:"/reference-guides/rancher-security/psa-restricted-exemptions"},"sample Admission Configuration"),"."),(0,a.kt)("h2",{id:"exempting-namespaces"},"Exempting Namespaces"),(0,a.kt)("p",null,"If you assign the ",(0,a.kt)("inlineCode",{parentName:"p"},"rancher-restricted")," template to a cluster, by default the restrictions are applied across the entire cluster at the namespace level. To exempt certain namespaces from this highly restricted policy, do the following:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"In the upper left corner, click ",(0,a.kt)("strong",{parentName:"li"},"\u2630 > Cluster Management"),"."),(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"Advanced")," to open the dropdown menu."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Pod Security Admissions"),"."),(0,a.kt)("li",{parentName:"ol"},"Find the template you want to modify, and click the ",(0,a.kt)("strong",{parentName:"li"},"\u22ee"),"."),(0,a.kt)("li",{parentName:"ol"},"Select ",(0,a.kt)("strong",{parentName:"li"},"Edit Config"),"."),(0,a.kt)("li",{parentName:"ol"},"Click the ",(0,a.kt)("strong",{parentName:"li"},"Namespaces")," checkbox under ",(0,a.kt)("strong",{parentName:"li"},"Exemptions")," to edit the ",(0,a.kt)("strong",{parentName:"li"},"Namespaces")," field."),(0,a.kt)("li",{parentName:"ol"},"When you're done exempting namespaces, click ",(0,a.kt)("strong",{parentName:"li"},"Save"),".")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"You need to update the target cluster to make the new template take effect in that cluster. An update can be triggered by editing and saving the cluster without changing values.")))}h.isMDXComponent=!0}}]);